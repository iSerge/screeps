module.exports=function(e){var r={};function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=r,o.d=function(e,r,t){o.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,r){if(1&r&&(e=o(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)o.d(t,n,function(r){return e[r]}.bind(null,n));return t},o.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(r,"a",r),r},o.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},o.p="",o(o.s=2)}([function(e,r){e.exports=require("lodash")},function(e,r,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=o(0);r.Messages={BUILD:"ðŸš§ build",CONSTRUCT_SYM:"ðŸ› ",DISTRIBUTE:"â†” distr",HARVEST:"ðŸ”„ harvest",PICKUP:"â¬† pickup",UPGRADE:"âš¡ upgrade"};var n=function(){function e(){}return e.buildPriority=function(e,r){var o;switch(r.structureType){case STRUCTURE_SPAWN:o=1;break;case STRUCTURE_EXTENSION:o=2;break;case STRUCTURE_CONTAINER:o=3;break;case STRUCTURE_LINK:o=4;break;case STRUCTURE_TOWER:o=5;break;case STRUCTURE_STORAGE:o=6;break;default:o=7}return e.memory.operateInRoom===r.pos.roomName?o:o+20},e.prototype.clearMemory=function(){t.forOwn(Memory.creeps,function(e,r){Game.creeps.hasOwnProperty(r)||(e.target&&delete Memory.harvestedSources[e.target],delete Memory.creeps[r])}),t.forOwn(Memory.rooms,function(e,r){Game.rooms.hasOwnProperty(r)||delete Memory.rooms[r]})},e.prototype.enqueueStructure=function(e,r){t.isUndefined(r)||t.includes(e.memory.repairQueue,r.id)||e.memory.repairQueue.push(r.id)},e.prototype.findConstructionSite=function(r){return t.sortBy(Game.constructionSites,[function(o){return e.buildPriority(r,o)}])[0]},e.prototype.getEnergy=function(e,r){var o;return r instanceof Resource?(o=e.pickup(r))===OK&&(e.memory.energyTarget=""):r instanceof Source?o=e.harvest(r):(o=e.withdraw(r,RESOURCE_ENERGY))===OK&&(e.memory.energyTarget=""),o},e.prototype.getEnergyStorageTarget=function(e){var r=Game.getObjectById(e.memory.energyTarget);if(!r){var o=e.room.find(FIND_DROPPED_RESOURCES,{filter:function(e){return e.resourceType===RESOURCE_ENERGY}});o=o.concat(e.room.find(FIND_MY_STRUCTURES,{filter:function(e){switch(e.structureType){case STRUCTURE_STORAGE:return 0<e.store[RESOURCE_ENERGY];case STRUCTURE_CONTAINER:return 0<e.store[RESOURCE_ENERGY];case STRUCTURE_LINK:return 0<e.energy;default:return!1}}})),r=e.pos.findClosestByPath(o,{maxOps:1e3})}return r||(r=e.pos.findClosestByPath(FIND_SOURCES)),r&&(e.memory.energyTarget=r.id),r},e.prototype.moveTo=function(e,r){ERR_NOT_FOUND===e.moveTo(r,{noPathFinding:!0,visualizePathStyle:{stroke:"#ffffff"}})&&e.moveTo(r,{reusePath:20,visualizePathStyle:{stroke:"#ffffff"}})},e.prototype.navigateToDesignatedRoom=function(e){return e.memory.operateInRoom!==e.pos.roomName},e.prototype.shiftStructure=function(e,r){var o=e.memory.operateInRoom;if(0<Memory.rooms[o].repairQueue.length)for(var n=Game.getObjectById(Memory.rooms[o].repairQueue[0]);!n;)Memory.rooms[o].repairQueue.shift(),n=Game.getObjectById(Memory.rooms[o].repairQueue[0]);var i=t.find(Memory.rooms[o].repairQueue,function(o){var n=t.isUndefined(o)?null:Game.getObjectById(o);return!(t.isNull(n)||r&&n.pos.roomName!==e.memory.operateInRoom)});return t.isUndefined(i)?null:(Memory.rooms[o].repairQueue=t.filter(Memory.rooms[o].repairQueue,function(e){return e!==i}),Game.getObjectById(i))},e.prototype.tryBuildRoad=function(e){Memory.autoBuildRoads&&(t.filter(e.room.lookAt(e.pos),function(e){return e&&e.structure&&(e.type===LOOK_STRUCTURES&&e.structure.structureType===STRUCTURE_ROAD||e.type===LOOK_CONSTRUCTION_SITES)}).length||e.room.createConstructionSite(e.pos,STRUCTURE_ROAD))},e.prototype.updateInfrastructure=function(){t.forOwn(Game.rooms,function(e){t.isUndefined(e.memory.repairQueue)&&(e.memory.repairQueue=[]),t.isUndefined(e.memory.spawnQueue)&&(e.memory.spawnQueue=[]),t.isUndefined(e.memory.creepCount)&&(e.memory.creepCount={})}),t.isUndefined(Memory.harvestedSources)&&(Memory.harvestedSources={}),t.isUndefined(Memory.autoBuildRoads)&&(Memory.autoBuildRoads=!0),t.isUndefined(Memory.maxWallHits)&&(Memory.maxWallHits=1e5),t.isUndefined(Memory.maxRampartHits)&&(Memory.maxRampartHits=3e4)},e}();r.Utils=n,r.utils=new n},function(e,r,o){e.exports=o(3)},function(e,r,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=o(0),n=o(4),i=o(1),u=new(function(){function e(){}return e.prototype.findDamagedStructures=function(){t.forOwn(Game.rooms,function(e){e.find(FIND_STRUCTURES,{filter:function(r){return(r.structureType===STRUCTURE_WALL&&r.hits<Memory.maxWallHits||r.structureType===STRUCTURE_RAMPART&&r.hits<Memory.maxRampartHits/2||r.structureType===STRUCTURE_CONTAINER&&r.hits<r.hitsMax-5e4||r.structureType!==STRUCTURE_RAMPART&&r.structureType!==STRUCTURE_WALL&&r.hits<r.hitsMax/2)&&i.utils.enqueueStructure(e,r),!1}})})},e.prototype.towerLogic=function(){t.forOwn(Game.structures,function(e){if(e.structureType===STRUCTURE_TOWER){var r=e,o=r.pos.findClosestByRange(FIND_HOSTILE_CREEPS,{filter:function(e){return e.pos.inRangeTo(r.pos,r.room.memory.towerActive?15:7)}});o?(r.room.memory.towerActive=!0,r.attack(o)):r.room.memory.towerActive=!1;var t=r.pos.findClosestByRange(FIND_MY_CREEPS,{filter:function(e){return e.hits<e.hitsMax/3}});if(t&&r.heal(t),700<r.energy){var n=r.pos.findClosestByRange(FIND_STRUCTURES,{filter:function(e){return e.structureType===STRUCTURE_RAMPART&&e.hits<Memory.maxRampartHits||e.structureType!==STRUCTURE_WALL&&e.structureType!==STRUCTURE_RAMPART&&e.hits<e.hitsMax/3}});n&&r.repair(n)}var i=r.pos.findClosestByRange(FIND_MY_CREEPS,{filter:function(e){return e.hits<e.hitsMax}});i&&r.heal(i)}})},e.prototype.creepActions=function(){t.forOwn(Game.creeps,function(e){n.rolesModule.run(e)})},e}());e.exports.loop=function(){i.utils.updateInfrastructure(),i.utils.clearMemory(),u.findDamagedStructures(),n.rolesModule.countCreeps(),t.forOwn(Game.rooms,function(e){e.controller&&(0===Object.getOwnPropertyNames(Game.creeps).length&&(e.memory.spawnQueue=[],e.memory.spawnQueue.unshift({body:[CARRY,MOVE],role:n.CARRIER}),e.memory.spawnQueue.unshift({body:[CARRY,WORK,WORK,MOVE],role:n.HARVESTER})),n.rolesModule.spawn(e))}),t.forOwn(Game.spawns,function(e){if(n.rolesModule.processSpawnQueue(e),e.spawning){var r=Game.creeps[e.spawning.name];e.room.visual.text(i.Messages.CONSTRUCT_SYM+" "+r.memory.role,e.pos.x+1,e.pos.y,{align:"left",opacity:.8})}}),u.towerLogic(),u.creepActions()}},function(e,r,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=o(0),n=o(5),i=o(6),u=o(7),a=o(8),s=o(9),m=o(10);r.BUILDER="builder",r.CARRIER="carrier",r.CLAIMER="claimer",r.HARVESTER="harvester",r.UPGRADER="upgrader",r.roles={builder:i.roleBuilder,carrier:u.roleCarrier,claimer:a.roleClaimer,harvester:s.roleHarvester,upgrader:m.roleUpgrader};var R=function(){function e(){}return e.prototype.countCreeps=function(){t.forOwn(r.roles,function(e,r){t.forOwn(Memory.rooms,function(e){e.creepCount[r]=0})}),t.forOwn(Game.creeps,function(e){e.memory.operateInRoom?Memory.rooms[e.memory.operateInRoom].creepCount[e.memory.role]+=1:Memory.rooms[e.room.name].creepCount[e.memory.role]+=1}),t.forOwn(Memory.rooms,function(e){t.forEach(e.spawnQueue,function(r){e.creepCount[r.role]+=1})})},e.prototype.processSpawnQueue=function(e){if(!e.spawning){var r=e.room,o=r.memory.spawnQueue.shift();if(o)if(console.log("Processing spawn Q "+e.name+" "+JSON.stringify({room:r.name,role:o.role})),e.canCreateCreep(o.body)===OK){var t=e.createCreep(o.body,void 0,{operateInRoom:r.name,role:o.role});console.log("Spawning new "+o.role+": "+t)}else"claimer"===o.role?r.memory.spawnQueue.push(o):r.memory.spawnQueue.unshift(o)}},e.prototype.run=function(e){r.roles[e.memory.role].run(e)},e.prototype.spawn=function(e,o){var n=this;if(o)if("string"==typeof o){var i=e.energyAvailable,u=r.roles[o].body(i);e.memory.spawnQueue.push({body:u,role:o})}else e.memory.spawnQueue.push(o);else t.forOwn(r.roles,function(r,o){if(o&&e.memory.creepCount[o]<n.limit(o)){var t=e.energyAvailable,i=r.body(t);e.memory.spawnQueue.push({body:i,role:o})}})},e.prototype.limit=function(e){return"claimer"===e&&t.isUndefined(Game.flags.claim)&&t.isUndefined(Game.flags.reserve)?0:n.limits[e]},e}();r.RolesModule=R,r.rolesModule=new R},function(e,r,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.limits={builder:2,carrier:3,claimer:2,harvester:2,upgrader:1}},function(e,r,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=o(0),n=o(1),i=function(){function e(){}return e.prototype.body=function(e){return e<350?[WORK,CARRY,CARRY,MOVE]:e<450?[WORK,CARRY,CARRY,MOVE,MOVE]:e<550?[WORK,WORK,CARRY,CARRY,MOVE,MOVE,MOVE]:e<600?[WORK,WORK,WORK,CARRY,CARRY,MOVE,MOVE,MOVE]:e<650?[WORK,WORK,WORK,CARRY,CARRY,CARRY,MOVE,MOVE,MOVE]:e<750?[WORK,WORK,WORK,CARRY,CARRY,CARRY,MOVE,MOVE,MOVE,MOVE]:[WORK,WORK,WORK,WORK,CARRY,CARRY,CARRY,MOVE,MOVE,MOVE,MOVE]},e.prototype.run=function(e){var r;if(n.utils.tryBuildRoad(e),e.memory.building||e.memory.energyTarget||!n.utils.navigateToDesignatedRoom(e)||!e.memory.operateInRoom){if(e.memory.building&&0===e.carry.energy&&(e.memory.building=!1,e.memory.energyTarget="",e.say(n.Messages.HARVEST)),e.memory.building||e.carry.energy!==e.carryCapacity||(e.memory.building=!0,e.say(n.Messages.BUILD)),e.memory.building)(r=Game.getObjectById(e.memory.buildTarget))||((r=n.utils.shiftStructure(e,!0))||(r=n.utils.findConstructionSite(e)),r||(r=n.utils.shiftStructure(e,!1)),r?e.memory.buildTarget=r.id:(e.say("ðŸš§ nothing"),e.memory.buildTarget="",e.memory.energyTarget="",e.memory.building=!1)),r instanceof Structure?r.structureType!==STRUCTURE_WALL&&r.structureType!==STRUCTURE_RAMPART&&r.hits<r.hitsMax||r.structureType===STRUCTURE_WALL&&r.hits<Memory.maxWallHits||r.structureType===STRUCTURE_RAMPART&&r.hits<Memory.maxRampartHits?e.repair(r)===ERR_NOT_IN_RANGE&&n.utils.moveTo(e,r.pos):(e.memory.buildTarget="",e.memory.building=!1):r instanceof ConstructionSite?e.build(r)===ERR_NOT_IN_RANGE&&n.utils.moveTo(e,r.pos):(e.memory.buildTarget="",e.memory.building=!1);else if(e.carry.energy<e.carryCapacity)if(r=n.utils.getEnergyStorageTarget(e)){var o=e.pos.findInRange([r],1);o.length?n.utils.getEnergy(e,o[0]):n.utils.moveTo(e,r.pos)}else e.say("No energy")}else n.utils.moveTo(e,new RoomPosition(25,25,e.memory.operateInRoom))},e.prototype.findConstructionSite=function(e,r){var o=null,n=t.filter(Game.constructionSites,function(o){return o.structureType===e&&o.pos.roomName===r.memory.operateInRoom});return n.length&&((o=r.pos.findClosestByPath(n))||(o=n[0])),o},e}();r.roleBuilder=new i},function(e,r,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=o(0),n=o(1),i=function(){function e(){}return e.prototype.body=function(e){var r;r=e<300?6:750<e?15:Math.floor(e/50);for(var o=new Array(r),t=Math.ceil(r/3),n=0;n<r;++n)o[n]=n<t?MOVE:CARRY;return o},e.prototype.run=function(e){var r;(n.utils.tryBuildRoad(e),e.memory.hauling||e.memory.energyTarget||!n.utils.navigateToDesignatedRoom(e)||!e.memory.operateInRoom)?(e.memory.hauling&&0===e.carry.energy&&(e.memory.hauling=!1,e.memory.energyTarget="",e.say(n.Messages.PICKUP)),e.memory.hauling||e.carry.energy!==e.carryCapacity||(e.memory.hauling=!0,e.memory.energyTarget="",e.say(n.Messages.DISTRIBUTE)),e.memory.hauling?(r=this.getStoreTarget(e))&&e.transfer(r,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE?n.utils.moveTo(e,r.pos):e.memory.energyTarget="":(r=this.getEnergyTarget(e))&&n.utils.getEnergy(e,r)===ERR_NOT_IN_RANGE?n.utils.moveTo(e,r.pos):e.memory.energyTarget=""):n.utils.moveTo(e,new RoomPosition(25,25,e.memory.operateInRoom))},e.prototype.getEnergyTarget=function(e){var r=Game.getObjectById(e.memory.energyTarget);if(r instanceof Source&&e.pos.inRangeTo(r.pos,2)&&(r=null),!r){var o=e.room.find(FIND_DROPPED_RESOURCES,{filter:function(e){return e.resourceType===RESOURCE_ENERGY&&50<e.amount}});r=t.sortBy(o,function(e){return-e.amount})[0]}if(!r){var n=e.room.find(FIND_STRUCTURES,{filter:function(r){if(r.structureType===STRUCTURE_CONTAINER){var o=r;return o.id!==e.room.memory.controllerCont&&20<o.store.energy}return!1}});r=t.sortBy(n,function(e){if(e.structureType===STRUCTURE_CONTAINER){var r=e;return r.storeCapacity-r.store.energy}return 0})[0]}r||(r=e.room.find(FIND_MY_STRUCTURES,{filter:function(e){if(e.structureType===STRUCTURE_STORAGE){var r=e;return r.structureType===STRUCTURE_STORAGE&&0<r.store.energy}return!1}})[0]);r||((r=e.pos.findClosestByPath(FIND_SOURCES_ACTIVE,{maxOps:100}))||(r=e.room.find(FIND_SOURCES)[0]));return r&&(e.memory.energyTarget=r.id),r},e.prototype.getStoreTarget=function(e){var r=Game.getObjectById(e.memory.energyTarget);if(r||e.room.energyAvailable<e.room.energyCapacityAvailable&&(r=e.pos.findClosestByPath(FIND_STRUCTURES,{filter:function(r){switch(r.structureType){case STRUCTURE_SPAWN:var o=r;return o.energy<o.energyCapacity&&e.memory.operateInRoom===o.pos.roomName;case STRUCTURE_EXTENSION:var t=r;return t.energy<t.energyCapacity&&e.memory.operateInRoom===t.pos.roomName;default:return!1}}})),!r){var o=Game.rooms[e.memory.operateInRoom],n=t.isNull(o)?null:Game.getObjectById(o.memory.controllerCont);n&&500<n.storeCapacity-n.store.energy&&(r=n)}if(!r){var i=t.filter(Game.structures,function(r){if(STRUCTURE_TOWER===r.structureType){var o=r;return o.room.name===e.memory.operateInRoom&&0<=o.energyCapacity-o.energy-300}return!1});r=t.sortBy(i,function(e){if(e.structureType===STRUCTURE_CONTAINER){var r=e;return r.energyCapacity+r.energy}return 0})[0]}r||(r=e.room.find(FIND_STRUCTURES,{filter:function(e){if(e.structureType===STRUCTURE_STORAGE){var r=e;return 0<r.storeCapacity-r.store.energy}return!1}})[0]);r||(r=e.room.find(FIND_STRUCTURES,{filter:function(r){switch(r.structureType){case STRUCTURE_EXTENSION:var o=r;return o.energy<o.energyCapacity&&e.memory.operateInRoom===o.pos.roomName;case STRUCTURE_SPAWN:var t=r;return t.energy<t.energyCapacity&&e.memory.operateInRoom===t.pos.roomName;default:return!1}}})[0]);return r&&(e.memory.energyTarget=r.id),r},e}();r.roleCarrier=new i},function(e,r,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=o(0),n=o(1),i=function(){function e(){}return e.prototype.body=function(e){return e<1400?[MOVE,MOVE,CLAIM]:[MOVE,MOVE,MOVE,MOVE,CLAIM,CLAIM]},e.prototype.run=function(e){n.utils.tryBuildRoad(e);var r=Game.flags.claim;r||(r=Game.flags.reserve);var o=r&&e.room.name===r.pos.roomName;if(r||delete e.memory.claimTarget,r&&!o&&n.utils.moveTo(e,r.pos),r&&o){var i=e.room.lookForAt(LOOK_STRUCTURES,r.pos);i.length&&t.forEach(i,function(r){r.structureType===STRUCTURE_CONTROLLER&&(e.memory.claimTarget=r.id)})}if(e.memory.claimTarget){var u=Game.getObjectById(e.memory.claimTarget);u&&("claim"===r.name?e.room.controller&&!e.room.controller.my?e.attackController(e.room.controller)===ERR_NOT_IN_RANGE&&e.moveTo(e.room.controller):e.claimController(u)!==OK&&n.utils.moveTo(e,u.pos):e.reserveController(u)!==OK&&n.utils.moveTo(e,u.pos))}},e}();r.roleClaimer=new i},function(e,r,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=o(1),n=function(){function e(){}return e.prototype.body=function(e){return e<350?[WORK,WORK,CARRY,MOVE]:e<400?[WORK,WORK,CARRY,MOVE,MOVE]:e<500?[WORK,WORK,CARRY,MOVE,MOVE,MOVE]:e<600?[WORK,WORK,WORK,CARRY,MOVE,MOVE,MOVE]:e<700?[WORK,WORK,WORK,WORK,CARRY,MOVE,MOVE,MOVE]:[WORK,WORK,WORK,WORK,WORK,CARRY,MOVE,MOVE,MOVE]},e.prototype.run=function(e){t.utils.tryBuildRoad(e);var r=Game.getObjectById(e.memory.target);if(r||(r=this.findSource(e))&&(r.room.name!==e.room.name&&console.log("Harvester found target in other room: "+r.room),Memory.harvestedSources[r.id]=r.id,e.memory.target=r.id,e.say(t.Messages.HARVEST)),0<e.carry.energy){var o=e.pos.findInRange(FIND_STRUCTURES,1,{filter:function(e){return e.structureType===STRUCTURE_LINK&&e.energy<e.energyCapacity||e.structureType===STRUCTURE_CONTAINER&&e.store.energy<e.storeCapacity}});o.length?e.transfer(o[0],RESOURCE_ENERGY):e.drop(RESOURCE_ENERGY)}r&&(e.harvest(r)===ERR_NOT_IN_RANGE&&t.utils.moveTo(e,r.pos))},e.prototype.findSource=function(e){return e.room.find(FIND_SOURCES,{filter:function(e){return!Memory.harvestedSources.hasOwnProperty(e.id)}})[0]},e}();r.roleHarvester=new n},function(e,r,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=o(1),n=function(){function e(){}return e.prototype.body=function(e){return e<350?[WORK,CARRY,MOVE,MOVE]:e<400?[WORK,WORK,CARRY,MOVE,MOVE]:e<500?[WORK,WORK,CARRY,MOVE,MOVE,MOVE]:e<600?[WORK,WORK,WORK,CARRY,MOVE,MOVE,MOVE]:e<700?[WORK,WORK,WORK,WORK,CARRY,MOVE,MOVE,MOVE]:[WORK,WORK,WORK,WORK,WORK,CARRY,MOVE,MOVE,MOVE]},e.prototype.run=function(e){if(t.utils.tryBuildRoad(e),t.utils.navigateToDesignatedRoom(e)&&e.memory.operateInRoom)t.utils.moveTo(e,new RoomPosition(25,25,e.memory.operateInRoom));else if(e.memory.upgrading&&0===e.carry.energy&&(e.memory.upgrading=!1,e.say(t.Messages.HARVEST)),e.memory.upgrading||e.carry.energy!==e.carryCapacity||(e.memory.upgrading=!0,e.memory.energyTarget="",e.say(t.Messages.UPGRADE)),e.memory.upgrading&&e.room.controller)e.upgradeController(e.room.controller)===ERR_NOT_IN_RANGE&&t.utils.moveTo(e,e.room.controller.pos);else{var r=t.utils.getEnergyStorageTarget(e);if(r){var o=e.pos.findInRange([r],1);o.length?t.utils.getEnergy(e,o[0]):t.utils.moveTo(e,r.pos)}}},e}();r.roleUpgrader=new n}]);
//# sourceMappingURL=main.js.map.js